(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[633],{255:(e,t,n)=>{"use strict";function a(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return a}}),n(5155),n(7650),n(5744),n(589)},2146:(e,t,n)=>{"use strict";function a(e){let{reason:t,children:n}=e;return n}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}}),n(5262)},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{bindSnapshot:function(){return i},createAsyncLocalStorage:function(){return r},createSnapshot:function(){return l}});let n=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class a{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}static bind(e){return e}}let s="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function r(){return s?new s:new a}function i(e){return s?s.bind(e):a.bind(e)}function l(){return s?s.snapshot():function(e,...t){return e(...t)}}},5028:(e,t,n)=>{"use strict";n.d(t,{default:()=>s.a});var a=n(6645),s=n.n(a)},5744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return a.workAsyncStorageInstance}});let a=n(7828)},5996:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var a=n(5155),s=n(5028),r=n(2115),i=n(5695),l=n(2971),o=n(454);function c(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)().get("id"),[n,s]=(0,r.useState)(!0),[c,d]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[p,b]=(0,r.useState)([]),[x,f]=(0,r.useState)({code:"",description:"",discount:"",type:"percentage",categories:[],maxDiscount:"",minOrderAmount:"",usageLimit:"",validUntil:"",isActive:!0}),h=()=>{let e=localStorage.getItem("token");return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}};(0,r.useEffect)(()=>{fetch("https://vibe-bites-backend.onrender.com/api/products/categories").then(e=>e.json()).then(e=>b(e.data.categories||[])),t&&fetch("https://vibe-bites-backend.onrender.com/api/admin/coupons/".concat(t),{headers:h()}).then(e=>e.json()).then(e=>{if(e.success&&e.data.coupon){let t=e.data.coupon;f({code:t.code||"",description:t.description||"",discount:t.discount||"",type:t.type||"percentage",categories:t.categories||[],maxDiscount:t.maxDiscount||"",minOrderAmount:t.minOrderAmount||"",usageLimit:t.usageLimit||"",validUntil:t.validUntil?t.validUntil.slice(0,10):"",isActive:t.isActive})}else d(e.message||"Coupon not found");s(!1)}).catch(()=>{d("Error loading coupon"),s(!1)})},[t]);let g=e=>{let{name:t,value:n,type:a,checked:s}=e.target;"categories"===t?f(e=>({...e,categories:s?[...e.categories,n]:e.categories.filter(e=>e!==n)})):"checkbox"===a?f(e=>({...e,[t]:s})):f(e=>({...e,[t]:n}))},j=async n=>{n.preventDefault(),s(!0),d(""),m("");try{let n=["Makhana","Chips","Bites","Nuts","Seeds"],a={code:x.code.trim(),description:x.description.trim(),discount:parseFloat(x.discount),type:x.type,categories:x.categories.filter(e=>n.includes(e)),maxDiscount:x.maxDiscount?parseFloat(x.maxDiscount):void 0,minOrderAmount:x.minOrderAmount?parseFloat(x.minOrderAmount):void 0,usageLimit:x.usageLimit?parseInt(x.usageLimit):void 0,validUntil:x.validUntil,isActive:x.isActive},s=await fetch("https://vibe-bites-backend.onrender.com/api/coupons/".concat(t),{method:"PUT",headers:h(),body:JSON.stringify(a)}),r=await s.json();s.ok?(m("Coupon updated successfully!"),setTimeout(()=>e.push("/admin"),1200)):r.errors&&Array.isArray(r.errors)?d(r.errors.map(e=>e.msg).join(", ")):d(r.message||"Error updating coupon")}catch(e){d("Network error")}finally{s(!1)}};return n?(0,a.jsx)("div",{className:"p-8 text-center",children:"Loading..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.default,{}),(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Edit Coupon"}),(0,a.jsxs)("form",{onSubmit:j,className:"max-w-lg mx-auto bg-white p-6 rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Coupon Code"}),(0,a.jsx)("input",{type:"text",name:"code",value:x.code,onChange:g,className:"w-full border px-3 py-2 rounded",required:!0,maxLength:20})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Description"}),(0,a.jsx)("input",{type:"text",name:"description",value:x.description,onChange:g,className:"w-full border px-3 py-2 rounded",required:!0,maxLength:200})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Discount"}),(0,a.jsx)("input",{type:"number",name:"discount",value:x.discount,onChange:g,className:"w-full border px-3 py-2 rounded",required:!0,min:"0"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Type"}),(0,a.jsxs)("select",{name:"type",value:x.type,onChange:g,className:"w-full border px-3 py-2 rounded",required:!0,children:[(0,a.jsx)("option",{value:"percentage",children:"Percentage"}),(0,a.jsx)("option",{value:"fixed",children:"Fixed"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Categories"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:p.map(e=>{let t=e.category||e._id||e;return(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",name:"categories",value:t,checked:x.categories.includes(t),onChange:g}),t]},t)})})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Max Discount (₹)"}),(0,a.jsx)("input",{type:"number",name:"maxDiscount",value:x.maxDiscount,onChange:g,className:"border px-3 py-2 rounded",min:"0"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Min Order Amount (₹)"}),(0,a.jsx)("input",{type:"number",name:"minOrderAmount",value:x.minOrderAmount,onChange:g,className:"border px-3 py-2 rounded",min:"0"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Usage Limit"}),(0,a.jsx)("input",{type:"number",name:"usageLimit",value:x.usageLimit,onChange:g,className:"border px-3 py-2 rounded",min:"-1"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Expiry Date"}),(0,a.jsx)("input",{type:"date",name:"validUntil",value:x.validUntil,onChange:g,className:"w-full border px-3 py-2 rounded",required:!0})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",name:"isActive",checked:x.isActive,onChange:g}),"Active"]})}),(0,a.jsx)("div",{className:"mb-6 flex justify-center",children:(0,a.jsx)("button",{type:"submit",className:"bg-primary text-white px-8 py-3 rounded-lg text-lg font-semibold shadow hover:bg-primary-dark transition border-2 border-primary",disabled:n,style:{minWidth:"180px"},children:n?"Saving...":"Save Changes"})}),u&&(0,a.jsx)("p",{className:"text-green-600 mt-4",children:u}),c&&(0,a.jsx)("p",{className:"text-red-600 mt-4",children:c})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)("button",{onClick:()=>e.push("/admin"),className:"text-primary hover:underline",children:"← Back to Admin"})})]}),(0,a.jsx)(o.default,{})]})}let d=()=>(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-vibe-bg text-vibe-brown",children:"Loading..."}),children:(0,a.jsx)(c,{})}),u=(0,s.default)(()=>Promise.resolve(d),{ssr:!1,loading:()=>(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-vibe-bg text-vibe-brown",children:"Loading..."})})},6645:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}});let a=n(8229)._(n(7357));function s(e,t){var n;let s={};"function"==typeof e&&(s.loader=e);let r={...s,...t};return(0,a.default)({...r,modules:null==(n=r.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},6724:(e,t,n)=>{Promise.resolve().then(n.bind(n,5996))},7357:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let a=n(5155),s=n(2115),r=n(2146);function i(e){return{default:e&&"default"in e?e.default:e}}n(255);let l={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},o=function(e){let t={...l,...e},n=(0,s.lazy)(()=>t.loader().then(i)),o=t.loading;function c(e){let i=o?(0,a.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,l=!t.ssr||!!t.loading,c=l?s.Suspense:s.Fragment,d=t.ssr?(0,a.jsxs)(a.Fragment,{children:[null,(0,a.jsx)(n,{...e})]}):(0,a.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(n,{...e})});return(0,a.jsx)(c,{...l?{fallback:i}:{},children:d})}return c.displayName="LoadableComponent",c}},7828:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return a}});let a=(0,n(4054).createAsyncLocalStorage)()}},e=>{e.O(0,[874,197,814,441,964,358],()=>e(e.s=6724)),_N_E=e.O()}]);