(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[992],{693:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>m});var a=i(5155),t=i(2115),l=i(2971),n=i(454),r=i(6874),c=i.n(r);function m(){let[e,s]=(0,t.useState)([]),[i,r]=(0,t.useState)({code:"",description:"",discount:"",type:"percentage",categories:[],minOrderAmount:"",maxDiscount:"",noLimit:!1,usageLimit:"",validFrom:"",validUntil:"",isActive:!0,isFirstTimeOnly:!1,applicableUsers:"",excludedUsers:""}),[m,d]=(0,t.useState)(!1),[o,u]=(0,t.useState)(""),[p,x]=(0,t.useState)("");(0,t.useEffect)(()=>{fetch("/api/products/categories").then(e=>e.json()).then(e=>{s(e.data.categories||[])})},[]);let b=e=>{let{name:s,value:i,type:a,checked:t}=e.target;"categories"===s?r(e=>({...e,categories:t?[...e.categories,i]:e.categories.filter(e=>e!==i)})):"noLimit"===s?r(e=>({...e,noLimit:t,maxDiscount:t?"":e.maxDiscount})):"isActive"===s||"isFirstTimeOnly"===s?r(e=>({...e,[s]:t})):r(e=>({...e,[s]:i}))},h=async e=>{e.preventDefault(),d(!0),u(""),x("");try{let e=["Makhana","Chips","Bites","Nuts","Seeds"],s={code:i.code.trim(),description:i.description.trim(),discount:parseFloat(i.discount),type:i.type,categories:i.categories.filter(s=>e.includes(s)),minOrderAmount:i.minOrderAmount?parseFloat(i.minOrderAmount):0,maxDiscount:i.noLimit?-1:i.maxDiscount?parseFloat(i.maxDiscount):void 0,usageLimit:i.usageLimit?parseInt(i.usageLimit):-1,validFrom:i.validFrom||new Date().toISOString().slice(0,10),validUntil:i.validUntil,isActive:i.isActive,isFirstTimeOnly:i.isFirstTimeOnly,applicableUsers:i.applicableUsers?i.applicableUsers.split(",").map(e=>e.trim()):[],excludedUsers:i.excludedUsers?i.excludedUsers.split(",").map(e=>e.trim()):[]},a=await fetch("/api/coupons",{method:"POST",headers:(()=>{let e=localStorage.getItem("token");return{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})(),body:JSON.stringify(s)}),t=await a.json();a.ok?(u("Coupon added successfully!"),r({code:"",description:"",discount:"",type:"percentage",categories:[],minOrderAmount:"",maxDiscount:"",noLimit:!1,usageLimit:"",validFrom:"",validUntil:"",isActive:!0,isFirstTimeOnly:!1,applicableUsers:"",excludedUsers:""})):t.errors&&Array.isArray(t.errors)?x(t.errors.map(e=>e.msg).join(", ")):x(t.message||"Error adding coupon")}catch(e){x("Network error")}finally{d(!1)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.default,{}),(0,a.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Add Coupon"}),(0,a.jsxs)("form",{onSubmit:h,className:"max-w-lg mx-auto bg-white p-6 rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Coupon Code"}),(0,a.jsx)("input",{type:"text",name:"code",value:i.code,onChange:b,className:"w-full border px-3 py-2 rounded",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Description"}),(0,a.jsx)("input",{type:"text",name:"description",value:i.description,onChange:b,className:"w-full border px-3 py-2 rounded",required:!0,maxLength:200})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Discount"}),(0,a.jsx)("input",{type:"number",name:"discount",value:i.discount,onChange:b,className:"w-full border px-3 py-2 rounded",required:!0,min:"1"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Minimum Order Amount (₹)"}),(0,a.jsx)("input",{type:"number",name:"minOrderAmount",value:i.minOrderAmount,onChange:b,className:"w-full border px-3 py-2 rounded",min:"0"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Usage Limit"}),(0,a.jsx)("input",{type:"number",name:"usageLimit",value:i.usageLimit,onChange:b,className:"w-full border px-3 py-2 rounded",min:"-1",placeholder:"-1 for unlimited"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Valid From"}),(0,a.jsx)("input",{type:"date",name:"validFrom",value:i.validFrom,onChange:b,className:"w-full border px-3 py-2 rounded"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Is Active"}),(0,a.jsx)("input",{type:"checkbox",name:"isActive",checked:i.isActive,onChange:b})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"First Time Only"}),(0,a.jsx)("input",{type:"checkbox",name:"isFirstTimeOnly",checked:i.isFirstTimeOnly,onChange:b})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Applicable Users (comma separated user IDs)"}),(0,a.jsx)("input",{type:"text",name:"applicableUsers",value:i.applicableUsers,onChange:b,className:"w-full border px-3 py-2 rounded"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Excluded Users (comma separated user IDs)"}),(0,a.jsx)("input",{type:"text",name:"excludedUsers",value:i.excludedUsers,onChange:b,className:"w-full border px-3 py-2 rounded"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Type"}),(0,a.jsxs)("select",{name:"type",value:i.type,onChange:b,className:"w-full border px-3 py-2 rounded",required:!0,children:[(0,a.jsx)("option",{value:"percentage",children:"Percentage"}),(0,a.jsx)("option",{value:"fixed",children:"Fixed"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Categories"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-3",children:e.map(e=>{let s=e.category||e._id||e;return(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",name:"categories",value:s,checked:i.categories.includes(s),onChange:b}),s]},s)})})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Max Discount (₹)"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("input",{type:"number",name:"maxDiscount",value:i.maxDiscount,onChange:b,className:"border px-3 py-2 rounded",min:"0",disabled:i.noLimit,style:{width:"150px"}}),(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",name:"noLimit",checked:i.noLimit,onChange:b}),"No Limit"]})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block font-medium mb-2",children:"Expiry Date"}),(0,a.jsx)("input",{type:"date",name:"validUntil",value:i.validUntil,onChange:b,className:"w-full border px-3 py-2 rounded",required:!0})]}),(0,a.jsx)("div",{className:"mb-6 flex justify-center",children:(0,a.jsx)("button",{type:"submit",className:"bg-primary text-white px-8 py-3 rounded-lg text-lg font-semibold shadow hover:bg-primary-dark transition border-2 border-primary",disabled:m,style:{minWidth:"180px"},children:m?"Adding...":"Add Coupon"})}),o&&(0,a.jsx)("p",{className:"text-green-600 mt-4",children:o}),p&&(0,a.jsx)("p",{className:"text-red-600 mt-4",children:p})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(c(),{href:"/admin",className:"text-primary hover:underline",children:"← Back to Admin"})})]}),(0,a.jsx)(n.default,{})]})}},6555:(e,s,i)=>{Promise.resolve().then(i.bind(i,693))}},e=>{e.O(0,[874,197,814,441,964,358],()=>e(e.s=6555)),_N_E=e.O()}]);